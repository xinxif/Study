### 链接

#### 编译器驱动程序

- 编译步骤

  - `g++ -E main.cxx`进行**预处理**
    - `g++ -E main.cxx -o main.i` 进行预处理并生成`main.i`文件

  - `g++ -S main.i -o main.s`翻译成一个ASCII汇编文件
    - `-S`选项告诉编译器将输入文件**编译为汇编代码**
    - `-o`指定输出文件为`main.s`

  - `g++ -c main.s -o main.o`
    - 翻译成**可重定向目标文件**

  - `g++ main.o sum.o -o program`
    - 链接

- 静态链接

  - ==**链接器必须完成的两个主要任务**==
    - **符号解析**
      - 目标文件定义和引用符号，**每个符号**对应于一个**函数**、一个**全局变量**或一个**静态变量**。==符号解析的目的是将每个符号引用正好和一个符号定义关联起来。==
    - **重定向**
      - 编译器和汇编器生成从地址0开始的代码和数据节。链接器通过把每个符号定义与一个内存位置关联起来，从而重定位这些节，然后修改所有对这些符号的引用，使得它们指向这个内存位置。链接器使用汇编器产生的重定位条目的详细指令，不加甄别地执行这样的重定位。
  - 链接器的一些基本事实
    - ==**目标文件纯粹是字节块的集合**==。这些**块中**，**有些包含程序代码**,**有些包含程序数据**，而其他的则包含**引导链接器和加载器的数据结构**。链接器将这些块连接起来，确定被连接块的运行时位置，并且修改代码和数据块中的各种位置。==**链接器对目标机器了解甚少。产生目标文件的编译器和汇编器已经完成了大部分工作。**==

- 目标文件

  - **可重定位目标文件**。包含二进制代码和数据，其形式可以在编译时与其他可重定位目标文件合并起来，创建一个可执行目标文件。
  - **可执行目标文件**。包含二进制代码和数据，其形式可以被直接复制到内存并执行。
  - **共享目标文件**。一种特殊类型的可重定位目标文件，可以**在加载或者运行时**被动态地加载进内存并链接。
  - **编译器和汇编器**生成可重定向目标文件（包括共享目标文件），**连接器**生成可执行目标文件

