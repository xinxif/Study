### 第一章

#### 电路交换，分组交换和报文交换

1. 电路交换
   - **计算机之间的数据传送是突发式**的，当**使用电路交换**来传送计算机数据时，其**线路的传输效率一般都会很低**，线路上真正用来传送数据的时间往往不到10%甚至1%。
2. 分组交换
   - 优点
     - 没有建立连接和释放连接的过程
     - 分组传输过程中逐段占用通信链路，有较高的通信线路利用率
     - 交换节点可以为每一个分组独立选择转发路由，使得网络有很好的生存性
   - 缺点
     - 分组首部带来了额外的传输开销
     - 交换节点存储转发分组会照成一定的时延
     - 无法确保通信时端到端通信资源全部可用，在通信量较大时可能造成网络拥堵
     - 分组可能会出现失序和丢失等问题
3. 报文交换
   - 报文交换是分组交换的前身。在报文交换中，**报文被整个地发送**，而不是拆分成若干个分组进行发送。交换节点将**报文整体接收完成后**才能查找转发表，将整个报文转发到下一个节点。因此，报文交换比分组交换带来的**转发时延要长很多**，需要交换节点具有的**缓存空间也大很多**。
4. 三种交换方式的对比
   - **若要连续传送大量的数据，并且数据传送时间远大于建立连接的时间**，**则使用电路交换可以有较高的传输效率。**然而计算机的==**数据传送往往是突发式的**==，采用电路交换时通信线路的利用率会很低。
   - 报文交换和分组交换都==**不需要建立连接**==（即预先分配通信资源)，在传送计算机的**突发数据时可以提高通信线路的利用率。**
   - 将报文构造成若干个更小的分组进行分组交换，比将整个报文进行报文交换的时延要小，并且还可以避免太长的报文长时间占用链路，有利于差错控制，同时具有更好的灵活性。

#### 计算机网络的性能指标

1. 速率

   - | 数据量的单位 | 换算关系       |
     | ------------ | -------------- |
     | 比特(b)      | 基本单位       |
     | 字节(B)      | 1B=8bit        |
     | 千字节(KB)   | KB=2^10^ B     |
     | 兆字节(MB)   | MB=KKB=2^20^ B |
     | 吉字节(GB)   | GB=KMB=2^30^ B |
     | 太字节(TB)   | TB=KGB=2^40^ B |

   - 速率是指**数据的传送速率**，也成为**数据率**或**比特率**。基本单位为bit/s或bps。

   - | 速率的单位      | 换算关系              |
     | --------------- | --------------------- |
     | 比特/秒(b/s)    | 基本单位              |
     | 千比特/秒(kb/s) | kb/s=10^3^ b/s        |
     | 兆比特/秒(Mb/s) | Mb/s=k*kb/s=10^6^ b/s |
     | 吉比特/秒(Gb/s) |                       |
     | 太比特/秒(Tb/s) |                       |

2. 带宽

   - 带宽在模拟信号系统中的意义：某个信号所包含的各种不同频率成分所占据的**频率范围**

     - 单位：Hz（kHz，MHz，GHz）

   - 带宽在计算机网络中的意义：用来表示网络的**通信线路所能传送数据的能力**，即在单位时间内从网络中的某一点到另一点所能**通过的最高速据率**。

     - 单位：b/s（kb/s、Mb/s、Gb/s、Tb/s）

     - ==**数据传送速率**===min[主机接口速率，线路带宽，交换机或路由器的接口速率]

       

3. 吞吐量

   - 吞吐量是指在**单位时间内通过某个网络或接口的实际数据量**。吞吐量常被用于对实际网络的测量，以便获知到底有多少数据量通过了网络。
   - 吞吐量**受网络带宽的限制**。

4. 时延

   - 时延是指数据从网络的一端传送到另一端所耗费的时间，也称为延迟或迟延。数据可由一个或多个分组、甚至是一个比特构成。

   - ==**发送时延=数据帧长度(b)/发送速率(b/s)**== 

   - ==**传播时延=信道长度(m)/信号传播速率(m/s)**==
     - 自由空间：3.0*10 ^8^ m/s
     - 铜线：2.3*10 ^8^ m/s
     - 光纤：2.0*10 ^8^ m/s
     
   - 排队时延：不方便计算
   
   - 处理时延：不方便计算
   
5. **时延带宽积**

   - 时延带宽积是**传播时延**和**带宽**的乘积。链路的时延带宽积也称为**以比特为单位的链路长度**。

6. 往返时延

   - ==**往返**==时间（Round-Trip Time，RTT）是指从发送端发送数据分组开始，到发送端收到接收端发来的相应确认分组为止，总共耗费的时间。
   - **有效数据率=数据长度/发送时间+RTT**

7. 利用率

   - 链路利用率

     - 链路利用率是指==**某条链路有百分之几的时间**==是被利用的(即有数据通过)。
     - 完全空闲的链路的利用率为零。

   - 网路利用率

     - 网络利用率==**是指网络中所有链路的链路利用率的加权平均**==。
     - 根据排队论可知，**当某链路的利用率增大时，该链路引起的时延就会迅速增加**。
     - 当网络的通信量较少时，产生的时延并不大，但在网络通信量不断增大时，**分组在交换节点(路由器或交换机)中的排队时延会随之增大**，因此网络引起的时延就会增大。
     - 令**D ~0~ 表示网络空闲时的时延**，**D表示网络当前的时延**，那么在理想的假定条件下，可用下式来表示D，D ~0~ 和**网络利用率U**之间的关系。

     $$
     D = \frac{D_0}{1-U}
     $$

8. 丢包率

   - 丢包率是指在一定的时间范围内，传输过程中==**丢失的分组数量**==与==**总分组数量的比率**==。
     - 接口丢包率
     - 网络丢包率
     - 路径丢包率
     - 链路丢包率
     - 节点丢包率
   - 分组丢失主要有以下两种情况:
     - 分组在传输过程中出现误码，被传输路径中的节点交换机（例如路由器）或目的主机检测出误码而丢弃。
     - 节点交换机根据丢弃策略主动丢弃分组。丢包率可以反映网络的拥塞情况。
     - 无拥塞时路径丢包率为0。
     - 轻度拥塞时路径丢包率为1%~4%。
     - 严重拥塞时路径丢包率为5%~15%。

#### 计算机网络体系结构

1. 三种计算机网络体系结构

   | OSI 参考模型/法律规定 | TCP/IP 参考模型/==事实==标准 | 原理参考模型/教学 | 协议         |
   | --------------------- | ---------------------------- | ----------------- | ------------ |
   | 应用层                |                              |                   | HTTP SMTP .. |
   | 表示层                |                              |                   |              |
   | 会话层                | 应用层                       | 应用层            |              |
   | 运输层                | 运输层                       | 运输层            | TCP UDP      |
   | 网络层                | 网络层                       | 网络层            | IP           |
   | 数据链路层            |                              | 数据链路层        |              |
   | 物理层                | 网络接口层                   | 物理层            |              |

   1. 物理层
      1. 采用什么传输媒体
      2. 采用什么物理接口
      3. 采用什么信号表示比特0和1
   2. 数据链路层
      1. 标识网络中各主机(**主机编址，例如MAC地址**)
      2. 从比特流中区分出地址和数据（**数据封装格式**)
      3. 协调各主机争用总线（**媒体接入控制**)
      4. 以太网交换机的实现（**自学习和转发帧**)
      5. 检测数据是否误码（**差错检测**)
   3. 网络层
      1. 标识**网络**和**网络中**的各**主机**(**网络和主机共同编址，例如IP地址**)	
         - 网络号**192.168.0**.x，主机号192.168.0**.n**
      2. 路由器转发分组(**路由选择协议、路由表和转发表)**
   4. 运输层
      1. 进程之间基于网络的通信(**进程的标识**，例如端口号)
      2. 出现传输差错如何处理(**可靠传输和不可靠传输**)
   5. 应用层
      1. 通过应用进程间的交互来完成特定的网络应用
      2. 进行会话管理和数据表示

2. 计算机网络体系结构中的专用术语

   1. 实体
      - **实体**是指任何可发送或接收信息的**硬件**或**软件进程**。
      - **对等实体**是指通信双方**相同层次中的实体**。
   2. 协议
      - **协议**是控制两个对等实体在**“水平方向**”进行“**逻辑通信**”的**规则**的集合。
      - ==协议的**三要素**==：
        - **语法**：定义所交换信息的**格式**
        - **语义**：定义通信双方所要完成的**操作**
        - **同步**：定义通信双方的**时序关系**
   3. 服务
      - 在协议的控制下，**两个对等实体在水平方向的逻辑通信使得本层能够向上一层提供服务**。要实现本层协议，还需要使用下面一层所提供的服务。 
      - 协议是“**水平**”的，而服务是“**垂直**”的。
      - 实体看得见下层提供的服务，但并不知道实现该对等层次之间传送的数据包称为该层的协议数据单元(Protocol Data Unit，PDU)。同一系统内层与层之间交换的数据包称为服务数据单元(Service Data Unit，SDU)。服务的具体协议。下层的协议对上层的实体是“**透明**”的。
      - 在同一系统中**相邻两层的实体交换信息的逻辑接口**称为**服务访问点SAP**，它被用于区分不同的服务类型。
      - 帧的“类型”字段、IP数据报的“协议”字段，TCP报文段或UDP用户数据报的“端口号”字段都是SAP。
      - 上层要使用下层所提供的服务，必须通过与下层**交换一些命令**，这些命令称为**服务原语**。
      - 对等层次之间传送的**数据包**称为该层的**协议数据单元**(Protocol Data Unit，**PDU**)。
      - 同一系统内层与层之间交换的数据包称为**服务数据单元**(Service Data Unit，**SDU**)。

### 物理层

1. 物理层要实现的功能：“**透明**“传输比特流。

#### 物理层的接口特性

- **机械特性**
  - 形状和尺寸
  - 引脚数目和排列
  - 固定和锁定装置
- **电气特性**
  - 信号电压的范围
  - 阻抗匹配的状况
  - 传输速率
  - 距离限制
- **功能特性**：规定接口电缆的各条信号线的作用
- **过程特性**：规定在信号线上传输比特流的一组操作过程，包括个信号的时序关系

#### 数据通讯的基础知识

1. 数据通讯系统的模型

   - 一个**数据通讯系统**可**划分为三大部分**
     - ==**源系统**==（发送端，发送方）
       - 源点
         - **源点设备产生要传输的数据**。源点又称为**源站**或**信源**。
       - 发送器
         - 通常**源点**生成的数字比特流要通过**发送器编码后**才能够在传输系统中进行传输。
           - 典型的发送器：调制器 ，调制解调器。
     - ==**传输系统**==（传输网络）
     - ==**目的系统**==（接收端，接收方）
       - 接收器
         - 接收**传输系统**传送过来的信号，并把它转化为能被目的设备处理的信息。
           - 典型的接收器：解调器
       - 终点
         - 终点设备**从接收器**获取传送来的数字比特流，然后把信息输出。
         - 终点又称为**目的站**或**信宿**。

   - 常用术语
     - 通信的目的是传送**消息**(message)。语音，文字，图形，视频等都是消息。
     - ==**数据**==是运送**消息**的实体。
     - **数据**是用特定方式表示的**信息**，通常是有意义的符号序列。
     - ==**信号**==则是**数据**的电气或电磁表现。
       - 根据信号中代表消息的参数的取值范围不同，**信号**可分为两大类：
         - **模拟信号**或**连续信号**：代表**消息的参数**取值是连续的。
         - **数字信号**或**离散信号**：代表**消息的参数**取值是离散的。
     - 在使用**时间域**（或简称为**时域**）的波形表示数字信号时，代表不同离散数值的基本波形就称为**码元**。

#### 有关信道的几个基本概念

1. 串行传输和并行传输

   - **串行传输**：逐布特依次传输。**远距离传输**

   - **并行传输**：构造数据的多个比特被分别安排在不同的数据传输线上同时传输。**近距离采用**

2. **同步传输**和**异步传输**

   - <img style="width: 1700px;height:400px" src="Image\同步传输.png ">
   - 收发双方**时钟同步的方法**
     - **外同步**:在收发双方之间增加一条时钟信号线。
     - **内同步**:发送端将时钟信号编码到发送数据中一起发送（例如曼彻斯特编码）。
   - <img style="width: 1700px;height:100px" src="Image\异步传输.png ">
     - **字节之间异步**，即字节之间的时间间隔不固定。
     - **字节内的每个比特仍然要同步**，即各比特的持续时间是相同的。

1. **信道**：==**信道**==一般都是用来表示向**某一方向**传输信息的媒体。因此，一条通讯电路往往包含一条发送信道和一条接收信道。

   - 从通信双方信息交互的方式来看，可以有以下三种基本方式：
     - ==**单向通信**==或**单工通信**：即**只能由一个方向的通信**而没有反方行的交互。例如：无线电广播。
     - ==**双向交替通信**==或**半双工通信**：即通信双方都可以**发送消息，但不能双方同时发送**。
     - ==**双向同时通信**==或**全双工通信**：即通信双方可以同时**发送和接收信息**。
   - 单向通信只需要一条信道，而双向交替通信或双向同时通信则需要两条信道。

2. 来自==**信源的信号**==常称为**基带信号**（即基本频带信号）。计算机输出的代表各种文字或图像文件的数据信号都属于**基带信号**。

   - 基带信号往往包含较多的的**低频分量**，甚至由**直流分量**，而许多信道**不能传输**这种低频分量或直流分量。为了解决这一问题，就必须对**基带信号**进行==**调制**==。
   - **调制**分为两大类。
     - 一类是仅仅对基带信号的**波形**进行变换，使它能够于信道的特性相适应。变换后的信号仍然是基带信号。这类调制称为==**基带调制**==。由于这种基带调制是把**数字信号转化**为另一种形式的数字信号，倾向于称为==**编码**==。
     - 另一类调制则需要使用**载波**进行调制，把**基带信号的频率范围**搬到较高的频率，**并转化为模拟信号**。
       - 经过**载波**调制后的信号称为==**带通信号**==。
       - 而使用**载波的调制**称为==**带通调制**==。

3. 常用的**编码**方式

   - **不归零制**：正电平代表1，负电平代表0
   - **归零制**：正脉冲代表1，负脉冲代表0
   - ==**曼彻斯特编码**==：位**周期中心**的**上跳变代表0**，为周期中心的下跳变代表1。==**也可反过来定义**==。
   - ==**差分曼彻斯特编码**==：在**每一位的中心处始终有跳变**。位**开始边界**有跳变代表0，而位开始边界没有跳变代表1。

4. 基本的**带通调制**方法

   <img style="width: 1700px;height:400px" src="Image\带通调制.png ">

   - **调幅**：载波的**振幅**随基带数字信号而变化。如0和1分别对应着无载波或有载波输出。

   - **调频**：**载波**的**频率**随基带数字信号而变化。如0和1分别对应着频率f~1~和f~2~。

   - **调相**：载波的**初始相位**随着基带数字信号而变化。如0和1分别对应着相位0度和180度

   - **混合调制方法**：**载波的相位和振幅**可以结合起来一起调制，例如**正交振幅调制QAM**
     
     - 12种**相位**(QAM-16)
     
     - 每种==**相位有1或2种振幅**==可选
     
     - 可以调制出16种码元（波形），每种码元可以对应表示4个比特
     
     - 每个码元于4个比特的对应关系因该采用**格雷码**，即任意两个相邻的码元只有1个比特不同。
     
       <img style="width: 730px;height:300px" src="Image\格雷码.png ">

5. 信道的极限容量

   - **码元**传输的速率越高，**信号**传输的距离越远，**噪声干扰**越大或**传输媒体**质量越差，在接收端的波形失真就越严重。
   - **信道**能通过的**频率范围**是有限的且许多**高频分量**往往不能通过信道。如果信号中的高频分量在传输时受到衰减，接收端收到的波形前沿和后沿变得不那么陡峭了，每一个码元所占的时间界限也不再是很明确。这种现象**==码间串扰==**
   - **==奈氏准则==**：在**带宽为W(HZ)的低通信道中**，**若不考虑噪声的影响**，则==**码元传输**==的**最高速率是2W(==码元==/秒)**。
     - **传播速率超过此上限**，就会出现严重的码间串扰问题，使接收端对码元的判决（即识别）成为不可能。
     - ==码元传输速率又称为**波特率**，**调制速率**，**波形速率**或**符号速率**。==
     - **波特率**于**比特率**有一定的关系
       - 当一**个码元只携带1比特的信息量**时，波特率（码元/秒）于比特率（比特/秒）在数值上是相等的。
       - 当一**个码元只携带n比特的信息量**时，波特率（码元/秒）于比特率（比特/秒）在数值要乘以n
       - 每种**码元**可携带的**比特位数**为log~2~X

6. 信噪比

   - **信噪比**是**信号的平均功率**和**噪声的平均功率**之比，常记为S/N。常使用分贝(dB)作为**度量单位**
     - ==**信噪比(dB) = 10 log~10~(S/N) (dB)。**==
   - ==**香农公式**==：**信道的极限信息传输速率**C是：
     - ==**C = W log~2~(1+S/N) (bit/s)**==
     - W：信道的频率带宽（单位为Hz）

#### 物理层下面的传输媒体

1. 传输媒体的分类

   - **传输媒体**是计算机网络设备之间的物理通路，也称为**传输介质**或**传输媒介**。

   - 传输媒体并不包含在计算机网络体系结构中。

   - **导向型传输媒体**

     - 同轴电缆

       <img style="width: 1500px;height:100px" src="Image\同轴电缆.png ">

       - 基带同轴电缆(50Ω)：用于**数字传输**，在早期局域网中广泛使用。
       - 宽带同轴电缆(75Ω)：用于**模拟传输**，目前主要用于有线电视的入户线。

     - 双绞线

       - | 双绞线类别  | 带宽   | 线缆特点                  | 典型应用                    |
         | ----------- | ------ | ------------------------- | --------------------------- |
         | 3           | 16MHz  | 2对4芯双绞线              | 传统以太网10Mb/s；模拟电话  |
         | 4           | 20MHz  | 4对8芯双绞线              | 曾用于令牌局域网            |
         | 5           | 100MHz | 于4类相比增加了绞合度     | 传输速率不超过100Mb/s的应用 |
         | 5E（超5类） | 125MHz | 于5类相比衰减更小         | 传输速率不超过1Gb/s的应用   |
         | 6           | 250Mhz | 于5类相比改善了串扰等性能 | 传输速率高于1Gb/s的应用     |
         | 7           | 600Mhz | 使用屏蔽双绞线            | 传输速率高于10Gb/s的应用    |

       - **绞合的作用**

         - 减少相邻**导线间的电磁干扰**。
         - 抵御部分来**自外界的电磁干扰**。

     - 光纤

       - 光纤通信利用光脉冲在光纤中的传递来进行通信。由于可见光的频率非常高（约为10^8^MHz量级），因此一个光纤通信系统的**传输带宽远大于**目前其它各种传输媒体的带宽。

         <img style="width: 300px;height:100px" src="Image\光纤.png ">

         

         <img style="width: 400px;height:100px" src="Image\光纤折射.png ">

       - 当光从**高折射率**的媒体射向**低折射率**的媒体时，其**折射角大于入射角**。
       
       - 如果**入射角足够大**，就会**出现全反射**，即光碰到包层时，就会反射回纤芯。
       
         <img style="width: 300px;height:100px" src="Image\多模光纤.png ">
       
       - 只要**从纤芯中**射到**纤芯表面**的光线的**入射角大于某个临界角度**，就可以产生全反射。因此，存在在多条不同角度入射的光线在一条光纤中传输。
       
       - 若将**光纤的直径**减小到只有几个光波长的量级，则光纤就像一根波导那样，可使光线一直向前传输。
       
         <img style="width: 500px;height:100px" src="Image\单模光纤.png ">
       
       - 在光纤通信中，常用的三个光波波段的**中心波长**分别为：
       
         - 850nm	衰减较大，但其它特性较好
         - 1300nm      衰减较小
         - 1550nm      衰减较小

   - **非导向型传输媒体**(自由空间)

     - 无线电波，微波，红外线，大气激光，可见光。

#### 信道复用技术的基本原理

1. 复用就是在**一条传输媒体上同时传输多路用户的信号**。

   - 当**一条传输媒体的传输容量**大于多条信道传输的总容量时，就可以通过复用技术，在这条传输媒体上建立多条通信信道，以便充分利用传输媒体的带宽。

   - 尽管实现信道复用会增加通信成本（需要复用器、分用器以及费用较高的大容量共享信道)，但如果复用的信道数量较大，还是比较划算的。

     <img style="width: 700px;height:200px" src="Image\复用原理图.png ">

2. 常用的信道复用技术

   - ==频分复用FDM==

     - 使用调制的方法，把各路信号分别搬到适当的频率位置，使彼此不产生干扰。各路信号就在自己所分配到的信道中传输。
     - 频分复用的所有用户**同时**占用**不同的频带**(Hz)资源发送数据。
     - **频分多地址接入**FDMA

   - ==时分复用TDM==

     - 时分复用将时间划分为**一段段等长的时分复用帧**（**TDM**帧），每一个信号在每一个TDM帧占用固定的**时隙**。
     - **时分多地址接入**TDMA

   - ==波分复用WDM==

     - 根据频分复用的设计思想，可在一根光纤上同时传输**多个频率(波长)**相近的光载波信号，实现基于光纤的频分复用技术。
     - 目前可以在一 根光纤上复用80路或更多路的光载波信号。因此，这种复用技术也称为**密集波分复用**DWDM。

   - ==**码分复用CDM**==

     - ==**码分多址CDMA**==是码分复用的一种方式：

       - 各用户使用经过**特殊挑选的不同码型**，因此彼此不会造成干扰。

     - 码片序列

       - 每一个比特时间划分为**m个短的间隔，称为码片**

       - 每个**站**被指派一个**唯一**的**m bit码片序列**

         - 如**发送比特1**，发送==**自己的m bit码片序列**==
         - 如**发送比特0**，则发送==该码片序列的**二进制反码**==
           - 例如：S站的8bit码片序列是0001 1011
           - 发送比特1时，发送序列0001 1011
           - 发送比特0时，发送序列1110 0100
           - **S站的码片序列**：(-1 -1 -1 +1 +1 -1 +1 +1) 

       - 每个**站**分配的**码片**序列必须**不同**（常采用伪随机码序列）还要**互相正交**

         - 零向量S表示**站S的码片向量**，令**T表示其它任何站的码片向量**。两个不同站的码片序列**正交**，就是向量S和T的规格化内积等于0
           $$
           S \cdot T \equiv \frac{1}{m}\sum_{i=1} ^m S~i~T~i~ =0
           $$

         - 任何**一个码片向量和该码片向量自己**的规格化内积等于1
           $$
           S \cdot\ S \equiv \frac{1}{m} \sum_{i=1} ^1 {S~i~S~i~}=1
           $$

         - 一个码片向量和该码片**反码**的向量的规格化内积等于-1

         - 想接收哪个站的数据 ，就用哪个站的**码片**于收到的结果求内积。

### 数据链路层

#### 数据链路层概述

1. 概念
   - ==**链路(**==Link) 是指从一个节点到相邻节点的一段物理线路(有线或无线)，**而中间没有任何其他的交换节点**。
   - ==**数据链路**==(Data Link)是基于链路的。当在一条链路上传送数据时，除需要链路本身，还需要**一些必要的通信协议来控制这些数据的传输**，把**实现这些协议的硬件和软件加到链路上**，就构成了数据链路。
     - 计算机中的网络适配器(俗称**网卡**)和其相应的**软件驱动程序**就实现了这些协议。**一般的网络适配器都包含了==物理层==和==数据链路层==这两层的功能**。
   - 帧(Frame) 是数据链路层对等实体之间在**水平方向**进行逻辑通信的**协议数据单元**PDU。

#### 数据链路层的三个重要问题

1. 封装成帧和透明传输

   - 封装成帧是指数据链路层给上层交付下来的协议数据单元PDU**添加一个首部**和**一个尾部**，使之成为帧。
     - 数据为ASCLL码组成的文件时，帧定界可以使用特殊的**帧定界符**。SOH(01)和EOT(04)
   - 为了提高数据链路层传输帧的效率，应当使**帧的数据载荷的长度尽可能地大于首部和尾部的长度**。
   - 考虑到对缓存空间的需求以及差错控制等诸多因素，每一种数据链路层协议都规定了帧的数据载荷的长度上限，即==**最大传送单元**==(Maximum Transfer Unit,MTU)。例如，**以太网的MTU为1500个字节**
   - 透明传输
     - **发送端的数据链路层**在数据中出现控制字符SOH或EOT前面**插入一个转义字符ESC**(1B,00011011)。
     - 接受端的数据链路层**把数据送往网络层之前删除**这个转义字符。这种方法称为字节填充。

2. 差错检测

   - 奇偶校验

     - 奇校验是在待发送的数据后面**添加1个校验位**，使得添加该校验位后的**整个数据中比特1的个数为奇数**。
     - 偶校验是在待发送的数据后面**添加1个校验位**，使得添加该校验位后的**整个数据中比特1的个数为偶数**。
     - 在所传输的数据中，如果有**奇数个位发生误码**，则所包含比特1的数量的奇偶性会发生改变，**可以检测出误码**。
     - 在所传输的数据中，如果有**偶数个位发生误码**，则所包含比特1的数量的奇偶性不会发生改变，**无法检测出误码(漏检)**。

   - 循环冗余校验CRC

     - 收发**双方约定好一个生成多项式**G(X)。

     - 发送方基于待发送的数据和生成多项式G(X)，**计算出差错==检测码==（==冗余码==)**，将**冗余码添加到**待发送数据的后面一起传输。

     - 收方收到数据和冗余码后，通过生成多项式G(X)来计算收到的数据和冗余码是否产生了误码。

       - 发送方

         <img style="width: 700px;height:300px" src="Image\发送方CRC.png ">

       - 接受方

         <img style="width: 700px;height:300px" src="Image\接收方.png ">

       <img style="width: 700px;height:300px" src="Image\生成多项式举例.png ">

     - **算法要求生成多项式必须包含最低次项**

     - 余数的位数应与生成多项式最高次数相同，==**如果位数不够，则在余数前补0来凑足位数**==。

     - 位异或运算：**一个位为真且不是两个为同为1**，那么结果为真

#### 可靠传输

- **数据链路层向其上层**提供的服务类型

  - **不可靠传输服务:仅仅丢弃有误码的帧，其他什么也不做;**
    - 一般情况下，**有线链路的误码率比较低**。为了减小开销，**并不要求数据链路层向其上层提供可靠传输服务**。即使出现了误码，可靠传输的问题由其上层处理。
  - **可靠传输服务**:通过某种机制实现发送方发送什么，接收方最终就能收到什么。
    - **无线链路易受干扰**，误码率比较高，因此要**求数据链路层必须向其上层提供可靠传输服务**。
  - 传输差错
    - 误码（出现在数据链路层及下层）
    - 分组丢失，分组失序，分组重复（出现在数据链路层的上层）

- 可靠传输的相关概念

  - 可靠传输服务并不局限于数据链路层，其他各层均可选择实现可靠传输

  - 可靠传输的实现比较复杂，开销比较大，是否使用可靠传输取决于应用需求。

    <img style="width: 730px;height:300px" src="Image\可靠传输.png ">

- 停止-等待协议

  <img style="width: 730px;height:300px" src="Image\停止等待协议.png ">

  - 使用超时重传机制后，就可以不使用否认机制了，这样可使协议实现起来更加简单。但是,如果点对点链路的误码率较高，**使用否认机制可以使发送方在超时计时器超时前就尽快重传**。

  - 为了让接收方能够判断所收到的数据分组是否是重复的，需要给**数据分组编号**。由于**停止等待协议**的特性，**只需1个比特编序号即可**，即序号0和序号1。

  - 为了让发送方能够判断所收到的确认分组是否是重复的，需要给**确认分组编号**，所用比特数量与数据分组所用比特数量一样。

    - 数据链路层一般不会出现确认分组迟到的情况，因此在**数据链路层实现停止等待协议可以不用给确认分组编号**。

  - 给超时计时器设置的超时重传时间RT0应当仔细选择，**一般将RTO设置为略大于收发双方的平均往返时间RTT**。 

    - 在数据链路层，点对点的往返时间RTT比较固定，RTO就比较好设定。 
    - 在运输层，由于端到端往返时间非常不确定，设置合适的超时重传时间RTO有时并不容易。

  -  停止等待协议属于**自动请求重传**(Automatic Repeat reQuest, ARQ) 协议。即重传的请求是发送方自动进行的，而不是接收方请求发送方重传某个误码的数据分组。

  - **==信道利用率==**

    <img style="width: 730px;height:300px" src="Image\停止等待信道利用率.png ">

    - **==$U\approx\frac{T_D}{T_D+RTT+T_A} \approx\frac{T_D}{T_D+RTT}$==**
    - 卫星链路的RTT很大而无线局域网的RTT远小于$T_D$
    - 若出现超时重传，对于传送有用的数据信息来说，信道利用率还要降低。

- 回退N帧协议

  - 回退N帧协议采用流水线传输方式，并且利用==**发送窗口**==来限制发送方连续发送数据分组的数量，这属于连续ARQ协议。

  - 采用n个比特**给分组编序号**，序号范围是0~ (2^n^- 1)。本例假设采用3个比特给分组编序号，则序号范围是0~7
  
  - **发送方**需要维护一个==**发送窗口W~t~**== ,在未收到接收方确认分组的情况下，发送方可将序号落入W~t~内的==**所有**==**数据分组连续发送出去**。
  
    - 采用n个比特给分组便序号，**则W~t~的取值范围**是1<W~t~<=(2^n^-1)
    - 本例中W~t~ = 5
  
  - **接收方**需要维护一个接收窗口W~R~，只有==**正确到达接**==收方(==**无误码**==)==**且序号**==落入W~p~内的数据分组才被接收方接收。
  
    - ==**W~p~的取值只能是1**==,这一点与停止等待协议是相同的。
  
    <img style="width: 730px;height:300px" src="Image\回退N帧协议.png ">
  
  - 超时重传，**回退N帧的情况**
  
    - 一个数据分组的差错就可能引起大量数据分组的重传。在信道质量较差(容易出现误码)的情况下，回退N帧协议的信道利用率并不比停止等待协议的信道利用率高。
      - 累计确认
    - 接收方不必对收到的每一个数据分组都发送一个确认分组，而是可以在收到几个序号连续的数据分组后，对按序到达的最后-一个数据分组发送确认分组。
    - 接收方何时发送累积确认分组，由具体实现决定。
    - ==**确认分组ACKn表示序号为n及之前的所有数据分组都已经正确接收。**==
    - 累计确认的优点
      - 减少向网络中注入确认分组的数量
      - 及时确认分组丢失，也可能不必重传数据分组
    - 累计确认的缺点
      - 不能向发送方及时准确地反映出接收方已经正确接收的所有数据分组的数量
  
- 选着重传协议

  - 用$n(n>1)$个比特分组编号
    - $$\begin{aligned}\left.\begin{aligned}  1<W_R<=W_T\\W_T+W_R<=2^n\end{aligned}\right\}\end{aligned}1<W_R<=2^{n-1}$$
    - W~R~超过W~T~没有意义
    - 为了使发送方仅重传出现差错的数据分组，接收方**不再采用累积确认**，而需要对每一个正确接收的**数据分组进行逐一确认**。

- **点对点协议PPP**

  - 点对点是目前使用最广泛的**点对点数据链据层协议**
  
    <img style="width: 730px;height:100px" src="Image\ppp帧.png ">
  
    <img style="width: 730px;height:100px" src="Image\ppp帧2.png ">
  
    - **标志**(Flag）字段:PPP帧的定界符，取值为Ox7E。
      
      - **异步传输**：采用字节填充
      
      - **==信息字段==**出现0x7e，转变为2字节序列0x7d，0x5e
      
      - 信息字段出现==**0x7d**==，转变为2字节序列0x7d，0x5d
      
      - ==**将数据载荷中出现的每一个ASCII码控制字符**==（即**数值小于0x20**的字符)转换成0x7d，控制字符+0x20
      - **同步传输**：零比特填充
      - 对帧的数据载荷进行扫描（一般由硬件完成)，==**每出现5个连续的比特1，则在其后填充一个比特0。**==
      - 对帧的数据载荷进行扫描，**每出现5个连续的比特1时，就把其后的一个比特0删除**。
      
    - **地址**(Address)字段:取值为OxFF，预留(目前没有什么作用)。
  
    - **控制**(Control)段:取值为0x03，预留(目前没有什么作用)。
  
    - **协议**(Protocol)字段:其值用来**指明帧的数据载荷应向上交付给哪个协议处理**。
  
      - 控制协议LCP
  
      - 网络控制协议NCP
  
    - **帧检验序列**(Frame Check Sequence，FCS)字段:其值是使用循环冗余校验CRC计算出的检错码。
  
      <img style="width: 1730px;height:100px" src="Image\PCS计算方位.png ">
  
    - 接收方每收到一个PPP帧，就进行CRC检验。若CRC检验正确，就收下这个帧;否则，就丢弃这个帧。使用PPP的数据链路层，向上提供的是不可靠数据传输服务。
  
  - ppp的工作状态
  
    <img style="width: 730px;height:300px" src="Image\ppp工作原理.png ">
  

#### 使用广播信道的数据链路层

- 网络适配器

  - 计算机连接以太网，需要网络适配器（网卡）。网卡与CPU之间的通讯**并行传输**。网卡与外部以太网之间的通信**串行方式**。网卡除要实现**物理层和数据链路层功能**，其另外一个重要功能就是要**进行并行传输和串行传输的转换**。由于网络的传输速率和计算机内部总线上的传输速率并不相同，因此在网卡的核心芯片中都会包含用于缓存数据的存储器。

  - 多个主机连接在同一个广播信道上，实现两个主机之间的通信，则每个主机都必须有一个唯一的标识，即一个==**数据链路层地址**==。在每个主机**发送的帧的首部中**，都携带有**发送主机**(源主机）和**接收主**机(自的主机)**的数据链路层地址**。由于这类地址是用于媒体接入控制(Medium Access Control，MAC)的，因此被称为==**MAC地址**==。

    - MAC地址，硬件地址，物理地址
    - 标准方法 ：xx-xx-xx-xx-xx-xx
    - 其它标识法：xx:xx:xx:xx:xx:xx，xxxx,xxxx,xxxx

  - MAC地址是对网络上==**各接口**==的唯一标识，而不是对网络上各设备的唯一标识。

    <img style="width: 730px;height:300px" src="Image\MAC.png ">

  - 字节发送顺序：第1字节->第6字节，`b0->b7`

  - **广播MAC地址** FF:FF:FF:FF:FF:FF

  - 网卡还可被设置为一种特殊的工作方式:**混杂方式**(Promiscuous Mode)。工作在混杂方式的网卡，只要收到共享媒体上传来的帧就会收下，而不管帧的目的MAC地址是什么。

- CSMA/CD协议

  - 多址接入MA：多个站点连接在一条总线上,竞争使用总线。(同轴电缆)

  - 载波监听CS

    - 每个**站点在发送帧之前**，先要检测一下总线上是否有其他站点在发送帧（“**先听后说**”) :若检测到总线空闲96比特时间（发送96比特所耗费的时间，也称为帧间最小间隔)，则发送这个帧;若检测到总线忙，则继续检测并等待总线转为空闲96比特时间，然后发送这个帧。

  - 碰撞检测CD

    - 每个**正在发送帧的站点**边发送边检测碰撞（“边说边听”):一旦发现总线上出现碰撞,立即停止发送，退避体一段随机时间后再次从载波监听开始进行发送（“一旦冲突，立即停说，等待时机，重新再说”)。
    - 强化碰撞
      - 发送帧的站点一旦检测到碰撞，除了立即停止发送帧外，还要再继续发送32比特或48比特的人为干扰信号(Jamming Signal) ，以便有足够多的碰撞信号使所有站点都能检测出碰撞。

  - **缺点**

    - 载波监听检测到总线空闲，但总线并不一定空闲。
    - 使用CSMACD协议的共享总线以太网上的各站点，只是尽量避免碰撞并在出现碰撞时做出退避后重发的处理，但不能完全避免碰撞。
    - 在使用CSMA/CD协议时，由于正在发送帧的站点必须“边发送帧边检测碰撞”，因此**站点不可能同时进行发送和接收**，也就是不可能进行全双工通信，而**只能进行半双工通信（双向交替通信)**。

  - ==**共享式以太网的争用期**==

    <img style="width: 730px;height:300px" src="Image\共享式以太网的争用期.png ">

    - 站点从发送帧开始，最多经过时长2τ (即δ →0)就可检测出所发送的帧是否遭遇了碰撞。
    - 因此，共享总线以太网的==**端到端往返时间2τ**==被称为**争用期**(Contention Period)或**碰撞窗口**(CollisionWindow) ,它是一个非常重要的参数。
      - ==**站点从发送帧开始**==，**经过争用期2τ这段时间还没有检测到碰撞**，就可以肯定这次发送不会产生碰撞。
    - 从争用期的概念可以看出，共享总线以太网上的每一个站点从发送帧开始，到之后的一小段时间内，都有可能遭遇碰撞，而这一小段时间的长短是不确定的，它取决于另一个发送帧的站点与本站点的距离,但不会超过总线的端到端往返传播时延，即一个争用期2τ。
      - 很显然， 总线的长度越长(单程端到端传播时延越大)，网络中站点数量越多，发生碰撞的概率就越大。
      - 因此，共享以太网的总线长度不能太长，接入的站点数量也不能太多。

  - 共享式以太网的最小帧长和最大帧长

    - 为了确保共享总线以太网上的每一个站点在发送完一个完整的帧之前，能够检测出是否产生了碰撞,**帧**的==**发送时延**==就==**不能少于共享总线以太网端到端的往返时间**==，即一个争用期2t。

    - 对于10Mb/s的共享总线以太网，其争用期2t的值规定为51.2us，因此**==其最小帧长为512b==，即64B**。
      $10Mb/s \times 51.2us = 512b = 64B$

      - 当某个站点在发送帧时，如果帧的前64B没有遭遇碰撞，那么帧的后续部分也就不会遭遇碰撞。也就是说，如果遭遇碰撞，就一定是在帧的前64B之内。
      - 由于发送帧的站点边发送帧边检测碰撞，一旦检测到碰撞就立即中止帧的发送，此时已发送的数据量一定小于64B。因此，接收站点收到**长度小于64B的帧**，就可判定这是一个**遭遇了碰撞而异常中止的无效帧，将其丢弃即可**。

      <img style="width: 730px;height:100px" src="Image\MAC帧.png ">
      
      - **==物理层在发送以太网帧之前还要在前面添加8B的前导码==**

  - 共享式以太网的信道利用率

    <img style="width: 730px;height:100px" src="Image\退避时间.png ">

    - 如果连续多次发生碰撞，就表明可能有较多的站点参与竞争信道。但使用上述退避算法可使重传需要推迟的平均时间随重传次数而增大(即动态退避)，因而减小产生碰撞的概率。

    - 当重传达16次仍不能成功时，就表明同时打算发送帧的站点太多，以至于连续产生碰撞，此时应放弃重传并向高层报告。

      <img style="width: 730px;height:300px" src="Image\共享式以太网的信道利用率.png ">

    - 参数a的值因尽量小，以提高信达利用率

- 使用集线器的共享式以太网

  - 集线器

    - 使用集线器的以太网虽然**物理拓扑是星型的**，但在**逻辑上**仍然是一个**总线网**。总线上的各站点共享总线资源，使用的还是**CSMA/CD协议**。
    - 集线器**只工作在物理层**，它的每个接口仅简单地转发比特，并不进行碰撞检测。碰撞检测的任务由各站点中的网卡负责。
    - 集线器一般都有少量的容错能力和网络管理功能。例如，若网络中某个站点的网卡出现了故障而不停地发送帧，集线器可以检测到这个问题，在内部断开与出故障网卡的连线，使整个以太网能正常工作。
    - ==**10BASE-T**==
      - 10：传输速率为10Mb/s
      - BASE：采用基带信号进行传输
      - T：采用双绞线作为传输媒体，F代表光纤

  - 网桥

    - 网桥工作在数据链路层，而集线器仅工作在物理层<img style="width: 730px;height:300px" src="Image\网桥的工作原理.png ">

      <img style="width: 730px;height:300px" src="Image\网桥的工作原理2.png ">

    - 透明网桥的自学习和转发帧的流程

      - 透明网桥通过**自学习**算法建立转发表
      - 透明网桥中的“**透明**”，是指以太网中的各站点并不知道自己所发送的帧将会经过哪些网桥的转发，最终到达目的站点，也就是说，**以太网中的网桥对于各站点而言是看不见的**。
      - 透明网桥的标准是IEEE802.1D，它通过一种自学习算法基于以太网中个站点间的相互通信逐步建立起自己的转发表。
        - 网桥**收到帧后进行登记**（即自学习)，登记的**内容为帧的源MAC地址和进入网桥的接口号**。
        - 网桥根据帧的**目的MAC地址**和网桥的**转发表**对帧进行**转发**，包含以下三种情况:
          - 明确转发:网桥知道应当从哪个接口转发帧。
          - 盲目转发:网桥不知道应当从哪个接口转发帧，只能将其通过除进入网桥的接口外的其他所有接口转发。
          - 丢弃:网桥知道不应该转发该帧，将其丢弃。
        - **注意**：
          - 如果**网桥收到有==误码的帧==则直接丢弃**。
          - 如果网桥收到一个**无误码的广播帧**，则不用进行查表，而是直接从除接收该广播帧的接口的其他接口转发该广播帧。
          - 转发表中的每条记录都有其**有效时间，到期自动删除**。这是因为各站点的MAC地址与网桥接口的对应关系并不是永久性的，例如某个站点更换了网卡，其MAC地址就会改
      - 透明网桥的生成树协议STP
        - 为了提高以太网的**可靠性**，有时需要在两个以太网之间使用多个透明网桥来提供**冗余链路**。
        - 在增加冗余链路提高以太网可靠性的同时，却给网络引入了环路。
        - 网络中的广播帧将在环路中永久兜圈，造成广播帧充斥整个网络，网络资源被白白浪费，而网络中的主机之间无法正常通信!
        - 为了避免广播帧在环路中永久兜圈，透明网桥使用**生成树协议**(Spanning Tree Protocol，**STP**)，可以在增加冗余链路提高网络可靠性的同时，又避免环路带来的问题。
          - 不管网桥之间连接成了怎样复杂的带环拓扑，网桥之间通过交互**网桥协议单元**(Bridge Protocol DataUnit,**BPDU**)，找出原网络拓扑的一个连通子集(即生成树），在这个子集里整个连通的网络中不存在环路。

#### 交换式以太网

1. 概述

   - 网桥的接口数量很少，通常只有2~4个，一般只用来连接不同的网段。
   - 1990年面世的==**交换式集线器**==(Switching Hub)，实质上是具有**==多个接口的网桥==**，常称为以太网交换机(Switch）或二层交换机。
     - “二层”是指以太网交换机工作在数据链路层(包括物理层)。
     - 与网桥相同，交换机内部的转发表也是通过自学习算法，基于网络中各主机间的通信，自动地逐步建立起来的。
     - 另外，交换机也使用生成树协议STP，来产生能够连通全网但不产生环路的通信路径。
   - 仅使用交换机(而不使用集线器)的以太网就是交换式以太网。
   - 当交换机的接口与计算机或交换机连接时，可以工作在**全双工方式**，并能**在自身内部同时连通多对接口**，使每一对相互通信的计算机都能像独占传输媒体那样，无碰撞地传输数据，这样就不需要使用CSMA/CD协议了。
   - 当交换机的**接口连接的是集线器时**，该**接口就只能使用CSMA/CD协议并只能工作在半双工方式**。
   - 现在的交换机和计算机中的网卡都能自动识别上述两种情况，并自动切换到相应的工作方式。
   - 以太网交换机工作在数据链路层（包括物理层)，它接==**收并转发的PDU通常称为帧**==。以太网交换机收到帧后，在转发表中查找**帧的目的MAC地址所对应的接口号**，然后通过该接口转发帧。
   - 一般的交换机都采用“**存储转发**”方式，为了减小交换机的转发时延，某些交换机采用了直通(Cut-Through)交换方式。
   - 采用**直通交换方式**的交换机，在**接收帧*==的同时就立即==*按==帧的目的MAC地址==决定该帧的转发接口**，然后通过其内部基于硬件的交叉矩阵进行转发，而不必把整个帧先缓存后再进行处理。
     - 直通交换的时延非常小。
     - ==**直通交换不检查差错**==就直接将帧转发出去，有可能会将一些无效帧转发给其他主机。

2. 以太网的MAC帧格式

   - DIX Ethernet V2的帧格式与IEEE802.3的帧格式**仅“类型”字段有差别**。

   <img style="width: 730px;height:100px" src="Image\MAC帧.png ">

   - 类型：其值用来指明**数据载荷**中的内容是由上一层的哪个**协议**封装的，以便收到的MAC帧的数据载荷上交给上一层的这个协议。
     - 0x0800：TCP/IP网际层IP协议封装的PDU
     - 0X8137：由Novell网络层IPX协议封装的PDU
   - 物理层发送数据链路层的以太网V2的MAX帧在帧首部**添加8B的前导码***
     - 前7B表示同步码：**使接受方的始终同步**
     - 最后1B帧开始定界符

3. 虚拟局域网VLAN的实现机制

   - 虚拟局域网VLAN有多种实现技术，最**常见的就是基于以太网交换机的==接口==来实现VLAN**。这就需要以太网交换机能够实现以下两个功能:
     - 能够处理**带有VLAN标记的帧**，也就是==**IEEE 802.1Q**==帧。
     - 交换机的各**接口可以支持不同的接口类型**，不同接口类型的接口对帧的处理方式有所不同。
       - trunk，access
   - IEEE 802.1Q帧也称为Dot One Q帧，它对以太网V2的MAC帧格式进行了扩展:在==**源地址字段和类型字段之间插入了4字节的VLAN标签**==(tag)字段。
   - VLAN标签字段
     - **标签协议标识符TPID**:长度为16比特，其值固定为0x8100，表示该帧是IEEE 802.1Q帧。
     - **优先级PRI**:长度为3比特，取值范围是0~7，值越大优先级越高。当网络阻塞时，设备优先发送优先级高的802.1Q帧。
     - **规范格式指示符CFI**:长度为1比特，取值为0表示MAC地址以规范格式封装，取值为1表示MAC地址以非规范格式封装。对于以太网，CFI的取值为0。
     - **虚拟局域网标识符VID**:长度为12比特，取值范围是0~4095，其中**0和4095**保留不使用。
     - 802.1Q帧一般不由用户主机处理，而是由以太网交换机来处理:
       - 当交换机收到普通的以太网MAC帧时，会给其插入4字节的VLAN标签使之成为802.1Q帧，该处理简称为“打标签”。
       - 当交换机转发802.1Q帧时，可能会删除其4字节的VLAN标签使之成为普通的以太网MAC帧，该处理简称为“去标签”。交换机转发802.1Q帧时也有可能不进行“去标签”处理，是否进行“去标签”处理取决于交换机的接口类型。
     - 当以太网交换机上电启动后，若之前未对其各接口进行过VLAN的相关设置，则**各接口的接口类型默认为Access，并且各接口的缺省VLAN ID为1**，即各接口默认属于VLAN1。
       - 对于思科交换机，接口的缺省VLAN ID称为本征VLAN (Native VLAN)
       - 对于华为交换机，接口的缺省VLAN ID称为端口VLAN ID(Port VLAN ID)，简记为PVID。
   - Access
     - **Access接口一般用于连接用户计算机**，由于其只能属于一个VLAN，因此Access接口的PVID值与其所属VLAN的ID相同，其默认值为1。
     - 接收处理
       - **一般只接受“未打标签”的普通以太网MAC帧**，根据接收帧的接口的PVID给帧“打标签”，即插入4字节的VLAN标签字段，VLAN标签字段中的VID取值就是接口的PVID值。
     - 转发处理
       - 若帧中的VID值与接口的PVID值相等，**则给帧“去标签”后再进行转发**，**否则不转发帧**。因此，从Access接口转发出的帧，是不带VLAN标签的普通以太网MAC帧。
   - Trunk
     - Trunk接口**一般用于交换机之间的互连**。Trunk接口可以属于多个VLAN，即Trunk接口可以通过属于不同VLAN的帧。Trunk接口的默认PVID值为1，一般不建议用户修改，若互连的Trunk接口的PVID值不相等，则可能出现转发错误。
     - 接收处理
       - **既可以接收“未打标签”的普通以太网MAC帧，也可以接收“已打标签”的802.1Q帧**。若**接收到普通以太网MAC帧时，根据接收帧的接口的PVID给帧“打标签”，这与Access接口的处理相同**。
     - 转发处理
       - 对于**帧的VID值等于接口的PVID值的802.1Q帧，将其“去标签”转发**;对于帧的**VID值不等于接口的PVID值的802.1Q帧，将其直接转发**。因此，从Trunk接口转发出的帧，可能是普通以太网MAC帧,也可能是802.10帧。
   - Hybrid
     - Hybrid接口是**华为交换机私有的接口类型**。Hybrid接口既**可以用于交换机之间的互连**(与Trunk接口相同)，也**可用于交换机与用户计算机之间的互连**(与Access接口相同)。
     - 除此之外，Hybrid接口的绝大部分功能与Trunk接口相同。不同点在于Hybrid接口的转发处理:Hybrid接口会查看**帧的VID值是否在==接口的“去标签”列表中==**，若存在则“去标签”后转发，若不存在则直接转发。

#### 无线局域网WLAN

1. 无线局域网的组成

   - 无线局域网协议802.11
   - 802.11无线局域网可分为两类
     - 有固定基础设施的（广泛使用）
       - 是指预先建立的，能够覆盖一定地理范围的，多个固定的通信基站
     - 无固定基础设施的
   - <img style="width: 1730px;height:500px" src="Image\无线局域网.png ">
   - <img style="width: 1730px;height:500px" src="Image\无线局域网2.png ">
   - 本BSS内各站点之间的通信以及与本BSS外的站点之间的通信，都必须经过本BSS内的AP进行转发。
   - 网络管理员需要为AP分配一个最大32字节的**服务集标识符**(Service Setldentifier,**SSID**)和一个无线通信信道，SSID实际上就是使用该AP的802.11无线局域网的名字。
   - 802.11标准并没有定义实现漫游的具体方法，仅定义了以下一些基本服务
     - 关联服务
       - 被动扫描
         - AP周期性地发出信标帧（包含服务集标识符SSID，AP的MAC地址，所支持的速率，加密算法和安全匹配灯参数）
         - 移动站被动等待**信标帧**
       - 主动扫描
         - 移动站主动发出探测请求帧，等待来着AP的探测响应帧
       - 重建关联服务和分离服务
         - 如果一个移动站要把与某个接入点AP的关联转移到另一个AP，就可以使用重建关联服务，若要终止关联服务，就应使用分离服务

2. 无线局域网的物理层

   - <img style="width: 1730px;height:500px" src="Image\无线局域网的物理层.png ">

3. 无线局域网的数据链层

   - CSMA/CA协议

     <img style="width: 1730px;height:300px" src="Image\无线局域网协议.png ">

     - **DIFS是DCF帧间间隔**DIFS的长度为==**128us**==，在DCF方式中，DIFS用来发送数据帧和管理帧。DCF是==**分布式协调功能**==(Distributed Coordination Function，DCF）的英文缩写词。在DCF方式下，没有中心控制站点，每个站点使用CSMACA协议通过争用信道来获取发送权。DCF方式是802.11定义的默认方式(必须实现)。

     - 等待DIFS间隔是考虑到可能有其它的站**有高优先级的帧**要发送。

       - ==**数据帧**==的中的**持续时间**字段的值指出了**源站要占用的信道时间**（**包括目的站发回确认帧所需的时间**）。

     - 当某个站检测到**正在==信道中传送的帧首部中的“持续时间”字段==时**，就**调整自己的==网络分配向量==**(Netw'Allocation Vector，**NAV**)。**NAV指出了完成这次帧的传送且信道转入空闲状态所需的时间**。

     - ==**短帧间间隔**==(Short Interframe Space，SIFS）的长度为==28us==，它是最短的帧间间隔，用来分隔开属于一次对话的各帧。一个站点应当**能够在这段时间内从发送方式切换到接收方式**。使用SIFS的帧类型有ACK帧、CTS帧等。

     - CSMA/CA协议还需要**使用停止等待协议机制来实现可靠传输**

     - **==退避时间==**：当某个站在发送帧时，很可能有多个站都在监听信道并等待发送帧，一旦信道空闲，这些站几乎同时发送帧而产生碰撞。为了避免上述情况，所有要发送帧的站检测到信道从忙转为空闲后,都要执行退避算法。这样不仅可以减少发生碰撞的概率，还可避免某站长时间占用无线信道。

     - 当某个站要发送数据帧时，仅在这种情况下才**不使用退避算法**：==**检测到信道空闲，并且该数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧**==。除此之外的以下情况，都必须使用退避算法:

       - 在发送帧之前检测到信道处于忙态
       - 在每一次重传一个帧时
       - 在每一次成功发送帧后要连续发送下一个帧时

     - **退避算法**

       - 在执行退避算法时，站点为退避计时器设置一个随机的退避时间:
         - 当退避计时器的时间减小到零时，就==**开始发送数据**==;
         - 当退避计时器的时间还==未减小到零时而信道又转变为忙状态==，这时就**==冻结==**退避计时器的数值，重新等待信道变为空闲，再经过帧间间隔DIFS后，继续启动退避计时器。
       - 在进行第`i`次退避时，退避时间在**时隙编号**{0，1，..，2^2+i^-1}中随机选择一个，然后**乘以基本退避时间**（也就是**一个时隙的长度**）就可以得到随机的退避时间。当**时隙编号达到255时**(对应于第6次退避)就不再增加了。
       - <img style="width: 1730px;height:340px" src="Image\退避时间2.png ">

       **源站对信道进行预约**

       - ==**RTS**== (Request To Send)帧是短的控制帧，它包括源地址、目的地址和本次通信（包括目的站发回确认帧所需的时间)所需的持续时间。
       - ==**CTS**== (Clear To Send)帧是短的响应控制帧，它也包括本次通信所需的持续时间(从RTS帧中将此持续时间复制到CTS帧中)。
       - 除源站和目的站的其他各站，在收到CTS帧或数据帧后就推迟访问信道。这样就确保了源站和目的站之间的通信不会受到其他站的干扰。
       - 若RTS帧发生碰撞，源站就不可能收到CTS帧，源站会执行退避算法重传RTS帧。
       - 使用RTS帧和CTS帧进行信道预约会带来额外的开销。但由于RTS帧和CTS帧都很短，发生碰撞的概率、碰撞产生的开销以及本身的开销都很小。对于一般的数据帧，其发送时延往往远大于传播时延(因为是局域网)，碰撞的概率很大，且一旦发生碰撞而导致数据帧重发，则浪费的时间就很多，因此用很小的代价对信道进行预约往往是值得的。

     - 802.11无线局域网对用户提供了以下三种选着

       - 使用RTS帧和CTS帧。
       - 只有当数据帧的长度超过某个数值时才使用RTS帧和CTS帧。
       - 不使用RTS帧和CTS帧。

     - <img style="width: 1730px;height:300px" src="Image\无线局域网信道预约.png ">
   
   - 无线局域网MAC帧
   
      - 数据帧
   
         - 用于站点之间传送数据
   
         - <img style="width: 1730px;height:400px" src="Image\无线局域网MAC帧.png ">
   
         - **持续期**：用于实现CSMA/CA的**虚拟载波监听和信道预约机制**。在数据帧、RTS帧和CTS帧中用该字段指出将要持续占用信道的时长。
   
         - 符号控制：用来实现802.11的可靠传输，对数据帧进行编号
   
         - ==**地址1，2，3，4**==
   
            - 取决于控制字段中“去往DS”（到分配系统）和“来自DS"（分配系统）这两个字段的值
   
            - | 去往DS | 来自DS | 地址1      | 地址2      | 地址3    | 地址4    |
               | ------ | ------ | ---------- | ---------- | -------- | -------- |
               | 0      | 0      | 目的地址   | 源地址     | BSSID    | 未被使用 |
               | 0      | 1      | 目的地址   | 发送AP地址 | 源地址   | 未被使用 |
               | 1      | 0      | 接收AP地址 | 源地址     | 目的地址 | 未被使用 |
               | 1      | 1      | 接收AP地址 | 发送AP地址 | 目的地址 | 源地址   |
   
            - 
   
      - 控制帧
   
         - 通常与数据帧搭配使用
         - 负责区域的清空，虚拟载波监听的维护以及信道的接入，并于收到的数据帧时给予确认
         - ACK帧，RTS，CTS等属于控制帧
   
      - 管理帧
   
         - 用于加入或退出无线网络，以及处理AP之间连接的转移事宜
         - 信标帧，关联请求帧以及身份确认帧等都属于管理帧



### 网络层

1. 概述
   - 网络层的主要任务是将分组从源主机经过多个网络和多段链路传输到目的主机，可以将该任务划分为**分组转发**和**路由选择**两种主要的功能
   - 网络层向上层提供的两种服务
     - 面向连接的虚电路服务
       - 核心思想是“**可靠通信应由网络自身来保证**”。
       - 必须首先**建立网络层连接**—**虚电路**(Virtual Circuit，**VC**)，以保证通信双方所需的一切网络资源
       - 通信双方**沿着已建立的虚电路发送分组**。
         - 虚电路表示这是一条逻辑上的连接,分组沿着这条逻辑连接按照存储转发方式传送，而不是真正建立了一条物理连接。
         - 分组的首部仅在连接建立阶段使用完整的目的主句地址，之后每个分组的首部只需要携带一条虚电路编号即可
       - 通信结束后，需要**释放**之前所建立的虚电路
     - 无连接的数据报服务
       - 核心思想是“**可靠通信应由用户主机来保证**”。
       - **不需要建立网络层连接**。
       - **每个分组可走不同的路径**。因此，每个分组的首部都必须携带目的主机的完整地址。
       - 通信结束后，**没有需要释放的连接**。
   - **网际层**：向上层提供简单灵活的，无连接的不可靠的数据报服务
2. **网际协议IP**
   - IP是TCP/IP体系结构网络层中的核心协议
   - 网际控制报文协议**ICMP**
   - 网际组管理协议**IGMP**
   - 逆地址解析协议RARP：淘汰
   - 地址解析协议**ARP**

#### IPv4

1. Pv4地址是给因特网Internet上的==**每一个主机或路由器**的每一个接口**==分配的一个**在全世界范围内唯一的32比特的标识符**

2. IPv4地址的分类编址方法

   - **网络号**

     - 标识主机或路由器的接口所连接到的**网络**
     - **同一个网络**中，**不同**主机或路由器的**接口**的IPv4地址的**网络号必须相同**，表示他们属于同一个网络

   - **主机号**

     - 标识主机或路由器的**接口**
     - **同一个网络中**，**不同**主机或路由器的接口的IPv4地址的**主机号必须各不相同**，以便区分各主机或路由器的接口

   - 五类地址

     - <img style="width: 1730px;height:400px" src="Image\五类IPv4.png ">
     - A类地址
       - **最小网络号为0，标识本网络，不能指派。**
       - ==最小可指派的网络号为1，网络地址为1.0.0.0==
       - **最大网络号为127，作为本地环回测试地址**，不能指派
         - 最小的本地环回测试地址为127.0.0.1
         - 最大的本地换回测试地址为127.255.255.254
       - ==最大可指派的网络号为126，网络地址为126.0.0.0==
       - 可指派的A类网络数量为2^8-1^ -2 = 126
       - 每个A类网络中可分配的地址数量为2^24^-2=16777214
     - B类地址
       - ==最小可指派的网络号为**128.0**，网络地址为128.0.0.0==
       - ==最大可指派的网络号为191.255，网络地址为191.255.0.0==
       - 可指派的B类网络数量为2^16-2^=16384
       - 每个B类网络中可分配的地址数量为2^16^-2=65534
     - C类地址
       - ==最小可指派的网络号为**192.0.0**，网络地址为192.0.0.0==
       - ==最大可指派的网络号为223.255.255，网络地址为223.255.255.0==
       - 可指派的C类网络数量为2^24-3^=2097152
       - 每个C类网络中可分配的地址数量为2^8^-2=254
     - D类地址：**多播地址**
       - 第一个地址224.0.0.0，最后一个地址239.255.255.255
       - 地址数量2^28^
     - E类地址：**保留**
       - 第一个地址240.0.0.0最后一个地址255.255.255.255
       - 地址数量2^28^

   - A类、B类和C类地址都是单播地址，只有单播地址可以分配给网络中的主机(或路由器)的各接口。

   - ==**主机号为“全0”的地址是网络地址**==，不能分配给主机(或路由器)的各接口。

   - ==**主机号为“全1”的地址是广播地址**==，不能分配给主机(或路由器)的各接口。

   - 一般不适用的特殊IPv4地址

     - | 网络号 | 主机号             | IP地址                                                       | 作为源地址 | 作为目的地址 | 表示的意思                               |
       | ------ | ------------------ | ------------------------------------------------------------ | ---------- | ------------ | ---------------------------------------- |
       | 0      | 0                  | 0.0.0.0                                                      | Y          | N            | 本网络上的本主机（例如DHCP）             |
       | x      | host-id            | 0.host-id                                                    | Y          | N            | 在本网络上的某台主机host-id              |
       | 全1    | 全1                | 255.255.255.255                                              | N          | Y            | 只在本网络上进行广播（各路由器均不转发） |
       | net-id | 全1                | A类：net-id.255.255.255<br />B类：net-id.255.255<br />C类：net.id.255 | N          | Y            | 对网络net-id上的所有主机进行广播         |
       | 127    | 非全0或全1的任何数 | 127.0.0.1~127.255.255.254                                    | Y          | Y            | 用本地软件进行环回测试                   |

3. IPv4地址的划分子网编址方法

   - **子网掩码**可以表明分类IPv4地址的**主机号部分被借用几个比特作为==子网号==**
   - <img style="width: 1730px;height:100" src="Image\子网掩码.png ">
     - 默认子网掩码：是指在**未划分子网的情况下使用的子网掩码**
       - A类255.0.0.0。B类255.255.0.0。C类255.255.255.0

4. 无分类编址方法

   - ==**无分类域间路由选择CIDR**==

     - CIDR消除了传统A类，B类和C类地址及划分子网的概念

   - 无分类地址方法使用的**地址掩码**与划分子网使用的子网掩码类似，由32比特构成

     - 左起多个连续的比特1对应IPv4地址中的网络前缀
     - 之后的多个连续的比特0对应IPv4地址中的主机号
     - 无分类编址==**斜线记法**==：128.14.35.7 / 20

   - 无分类域间路由选择CIDR是将网络前缀都相同的、连续的多个无分类IPv4地址，组成一个CIDR地址块，只要知道CIDR地址块中的任何一个地址，就可以知道该地址块的以下全部细节:

     - 地址块中的**最小地址**
     - 地址块中的**最大地址**
     - 地址块中的**地址数量**
     - 地址块中聚合某类网络(A类、B类、C类)的数量
     - **地址掩码**

     <img style="width: 1730px;height:400" src="Image\无分类编址方法.png ">

     <img style="width: 1730px;height:400" src="Image\聚合路由.png ">

   - IPv4地址的应用规划

     - 使用定长子网掩码划分子网**FLSM**：即划分子网的编址方法
     - 变长子网掩码划分子网**VLSM**
       - 每个子块的起点位置不能随便选取，只能选取**主机号部分**是==**块大小（子网中可用的**总地址数**）整数倍**==的地址作为起点。
       - <img style="width: 1730px;height:400" src="Image\变长子网掩码划分子网.png ">

5. IPv4地址与MAC地址

   - 在数据包传输过程中，数据包的**源IP地址和目的IP地址保持不变**，数据包的**源MAC地址和目的MAC地址逐链路或网络改变**。

   - ARP协议

     <img style="width: 1730px;height:400" src="Image\ARP协议.png ">

     <img style="width: 1730px;height:400" src="Image\ARP协议2.png ">

     - 最后记录到主机A的ARP高速缓存表中
       - **动态**类型是通过ARP自动获取，生命周期默认是两分钟
       - **静态**类型手工配置，不同操作系统下的声明周期不同。
     - ARP协议被用来解决**同一个局域网上的主句或路由器的IP地址和MAC地址的映射问题**，不能跨网络使用。

   - ARP协议的其它类型报文

     - 无故ARP：检查IP地址冲突

6. IP数据报的发送和转发过程

   - 同一个网络中的主机可通过**交换机直接通信**

   - 不同网络间的通信需要通过路由器**中转**实现**间接交付**

     - 让本网络中的各主机能与其它网络中的各主机**进行通信**，就必须给本网络中的各主机指定本网络中的一个路由器
       - 被指定的路由器**也被称为默认网关**

     <img style="width: 1730px;height:400" src="Image\IP数据报的发送和转发流程.png ">
     
     - 基于IP数据报首部中的**目的IP地址**在路由表中进行查询
       - 若找到匹配的路由条目，则按该路由条目的指示进行转发;**否则丢弃该IP数据报**，并向发送该IP数据报的源主机发送差错报告。
     
     <img style="width: 1730px;height:400" src="Image\路由器进行广播.png ">

7. 























